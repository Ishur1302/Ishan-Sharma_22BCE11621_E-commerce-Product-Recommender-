rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Products collection - read by anyone, write temporarily enabled for seeding
    match /products/{productId} {
      allow read: if true;
      allow write: if true; // Temporarily enabled for auto-seeding
    }
    
    // User interactions - users can read/write their own
    match /user_interactions/{interactionId} {
      allow read: if request.auth != null && resource.data.user_id == request.auth.uid;
      allow create: if request.auth != null && request.resource.data.user_id == request.auth.uid;
      allow update, delete: if request.auth != null && resource.data.user_id == request.auth.uid;
    }
    
    // Recommendations - users can read their own, system can write
    match /recommendations/{recId} {
      allow read: if request.auth != null && resource.data.user_id == request.auth.uid;
      allow write: if request.auth != null && request.resource.data.user_id == request.auth.uid;
    }
    
    // Cart items - users can read/write their own
    match /cart_items/{cartId} {
      allow read: if request.auth != null && resource.data.user_id == request.auth.uid;
      allow create: if request.auth != null && request.resource.data.user_id == request.auth.uid;
      allow update, delete: if request.auth != null && resource.data.user_id == request.auth.uid;
    }
  }
}
